{"version":3,"sources":["../../src/commands/push-creds.ts"],"names":["program","command","description","option","asyncActionProjectDir","projectDir","options","apiKey","length","Error","ctx","Context","init","experienceName","manifest","owner","user","username","slug","android","updateFcmKey","fcmCredentials","fetchFcmKey","fcmApiKey","process","exit","removeFcmKey","vapidSubjectDescription","vapidPubkey","vapidPvtkey","vapidSubject","_uploadWebPushCredientials","results","chalk","green","vapidPublicKey","vapidPrivateKey","args","remotePackageName","Exp","getPublishInfoAsync","UserManager","getCurrentUserAsync","apiClient","ApiV2","clientForUser","result","getAsync","status","JSON","stringify","error","deleteAsync","isGeneration","putAsync","oldVapidData","yellow","yellowBright","configPath","ConfigUtils","findConfigFile","appJson","parse","fse","readFile","then","value","toString","changedProperties","expo","push","notification","cyan","writeFile","join"],"mappings":"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","sourcesContent":["import * as ConfigUtils from '@expo/config';\nimport { ApiV2, Exp, UserManager } from '@expo/xdl';\nimport chalk from 'chalk';\nimport { Command } from 'commander';\nimport fse from 'fs-extra';\n\nimport { Context } from '../credentials/context';\nimport log from '../log';\n\ntype VapidData = {\n  vapidSubject: string;\n  vapidPubkey?: string;\n  vapidPvtkey?: string;\n};\n\nexport default function (program: Command) {\n  program\n    .command('push:android:upload [project-dir]')\n    .description('Uploads a Firebase Cloud Messaging key for Android push notifications.')\n    .option('--api-key [api-key]', 'Server API key for FCM.')\n    .asyncActionProjectDir(async (projectDir: string, options: { apiKey?: string }) => {\n      if (!options.apiKey || options.apiKey.length === 0) {\n        throw new Error('Must specify an API key to upload with --api-key.');\n      }\n\n      const ctx = new Context();\n      await ctx.init(projectDir);\n      const experienceName = `@${ctx.manifest.owner || ctx.user.username}/${ctx.manifest.slug}`;\n\n      await ctx.android.updateFcmKey(experienceName, options.apiKey);\n      log('All done!');\n    });\n\n  program\n    .command('push:android:show [project-dir]')\n    .description('Print the value currently in use for FCM notifications for this project.')\n    .asyncActionProjectDir(async (projectDir: string) => {\n      const ctx = new Context();\n      await ctx.init(projectDir);\n      const experienceName = `@${ctx.manifest.owner || ctx.user.username}/${ctx.manifest.slug}`;\n\n      const fcmCredentials = await ctx.android.fetchFcmKey(experienceName);\n      if (fcmCredentials?.fcmApiKey) {\n        log(`FCM Api Key: ${fcmCredentials?.fcmApiKey}`);\n      } else {\n        log(`There is no FCM Api Key configured for this project`);\n        process.exit(1);\n      }\n    });\n\n  program\n    .command('push:android:clear [project-dir]')\n    .description('Deletes a previously uploaded FCM credential.')\n    .asyncActionProjectDir(async (projectDir: string) => {\n      const ctx = new Context();\n      await ctx.init(projectDir);\n      const experienceName = `@${ctx.manifest.owner || ctx.user.username}/${ctx.manifest.slug}`;\n\n      await ctx.android.removeFcmKey(experienceName);\n      log('All done!');\n    });\n\n  const vapidSubjectDescription =\n    'URL or `mailto:` URL which provides a point of contact in case the push service needs to contact the message sender.';\n\n  program\n    .command('push:web:upload [project-dir]')\n    .description('Uploads VAPID key pair and VAPID subject for web push notifications.')\n    .option('--vapid-pubkey [vapid-public-key]', 'URL-safe base64-encoded VAPID public key.')\n    .option('--vapid-pvtkey [vapid-private-key]', 'URL-safe base64-encoded VAPID private key.')\n    .option('--vapid-subject [vapid-subject]', vapidSubjectDescription)\n    .asyncActionProjectDir(async (projectDir: string, options: VapidData) => {\n      if (!options.vapidPubkey || !options.vapidPvtkey || !options.vapidSubject) {\n        throw new Error(\n          'Must specify all three fields (--vapid-pubkey, --vapid-pvtkey, and --vapid-subject) to upload.'\n        );\n      }\n\n      await _uploadWebPushCredientials(projectDir, options);\n    });\n\n  program\n    .command('push:web:generate [project-dir]')\n    .description('Generates VAPID key pair for web push notifications.')\n    .option('--vapid-subject [vapid-subject]', vapidSubjectDescription)\n    .asyncActionProjectDir(async (projectDir: string, options: VapidData) => {\n      if (!options.vapidSubject) {\n        throw new Error('Must specify --vapid-subject.');\n      }\n\n      const results = await _uploadWebPushCredientials(projectDir, options);\n      log(chalk.green(`Your VAPID public key is: ${results.vapidPublicKey}`));\n      log(chalk.green(`Your VAPID private key is: ${results.vapidPrivateKey}`));\n    });\n\n  program\n    .command('push:web:show [project-dir]')\n    .description(\n      'Prints the VAPID public key, the VAPID private key, and the VAPID subject currently in use for web notifications for this project.'\n    )\n    .asyncActionProjectDir(async (projectDir: string) => {\n      const {\n        args: { remotePackageName },\n      } = await Exp.getPublishInfoAsync(projectDir);\n      const user = await UserManager.getCurrentUserAsync();\n      const apiClient = ApiV2.clientForUser(user);\n\n      const result = await apiClient.getAsync(`credentials/push/web/${remotePackageName}`);\n\n      if (\n        result.status === 'ok' &&\n        result.vapidPublicKey &&\n        result.vapidPrivateKey &&\n        result.vapidSubject\n      ) {\n        log(JSON.stringify(result));\n      } else if (result.status === 'error') {\n        throw new Error(`Server returned an error: ${result.error}`);\n      } else {\n        throw new Error('Server returned an invalid result!');\n      }\n    });\n\n  program\n    .command('push:web:clear [project-dir]')\n    .description(\n      'Deletes previously uploaded VAPID public key, VAPID private key, and VAPID subject.'\n    )\n    .asyncActionProjectDir(async (projectDir: string) => {\n      log('Reading project configuration...');\n      const {\n        args: { remotePackageName },\n      } = await Exp.getPublishInfoAsync(projectDir);\n\n      log('Logging in...');\n      const user = await UserManager.getCurrentUserAsync();\n      const apiClient = ApiV2.clientForUser(user);\n\n      log(\"Deleting API key from Expo's servers...\");\n\n      await apiClient.deleteAsync(`credentials/push/web/${remotePackageName}`);\n    });\n}\n\nasync function _uploadWebPushCredientials(projectDir: string, options: VapidData) {\n  const isGeneration = !(options.vapidPubkey && options.vapidPvtkey);\n\n  log('Reading project configuration...');\n\n  const {\n    args: { remotePackageName },\n  } = await Exp.getPublishInfoAsync(projectDir);\n\n  log('Logging in...');\n\n  const user = await UserManager.getCurrentUserAsync();\n  const apiClient = ApiV2.clientForUser(user);\n\n  if (isGeneration) {\n    log(\"Generating and setting VAPID keys on Expo's servers...\");\n  } else {\n    log(\"Uploading VAPID keys to Expo's servers...\");\n  }\n\n  const results = await apiClient.putAsync(`credentials/push/web/${remotePackageName}`, {\n    vapidPublicKey: options.vapidPubkey,\n    vapidPrivateKey: options.vapidPvtkey,\n    vapidSubject: options.vapidSubject,\n  });\n\n  if (results.oldVapidData && results.oldVapidData.vapidPublicKey !== results.vapidPublicKey) {\n    log(\n      chalk.yellow(\n        `Warning: You have previously stored another VAPID key pair on Expo's servers. Your current action has overridden the old key pair. This means that all your web clients will not receive any new notifications from you until you have deployed the app containing the new VAPID public key, and that the user has visited the site again since then.`\n      )\n    );\n    log(chalk.yellow(`For your records:`));\n    log(chalk.yellow(`- Your old VAPID public key: ${results.oldVapidData.vapidPublicKey}`));\n    log(chalk.yellow(`- Your old VAPID private key: ${results.oldVapidData.vapidPrivateKey}`));\n    log(chalk.yellow(`- Your old VAPID subject: ${results.oldVapidData.vapidSubject}`));\n    log(\n      chalk.yellow(\n        `If you wish to undo the current action, you can use the following command to upload your old credentials back to Expo's servers:`\n      )\n    );\n    log(\n      chalk.yellowBright(\n        `expo push:web:upload --vapid-pubkey ${results.oldVapidData.vapidPublicKey} --vapid-pvtkey ${results.oldVapidData.vapidPrivateKey} --vapid-subject ${results.oldVapidData.vapidSubject}`\n      )\n    );\n  }\n  log(chalk.green(`VAPID data uploaded!`));\n\n  /**\n   * Customize app.json\n   */\n  log(`Reading app.json...`);\n  const { configPath } = ConfigUtils.findConfigFile(projectDir);\n  const appJson = JSON.parse(await fse.readFile(configPath).then(value => value.toString()));\n  const changedProperties = [];\n\n  if (user) {\n    if (appJson.expo.owner && appJson.expo.owner !== user.username) {\n      log(\n        chalk.yellow(\n          `Warning: expo.owner is already configured to be \"${appJson.expo.owner}\" in app.json, but your current username is \"${user.username}\". You will not receive any push notification if you do not change expo.owner to \"${user.username}\" in app.json. Alternatively, you could choose to login to \"${appJson.expo.owner}\" and then execute this command again.`\n        )\n      );\n    } else {\n      appJson.expo.owner = user.username;\n      changedProperties.push('expo.owner');\n    }\n  }\n\n  if (\n    appJson.expo.notification &&\n    appJson.expo.notification.vapidPublicKey &&\n    appJson.expo.notification.vapidPublicKey !== results.vapidPublicKey\n  ) {\n    log(\n      chalk.cyan(\n        `Notice: expo.notification.vapidPublicKey is already configured in app.json (${\n          appJson.expo.notification.vapidPublicKey\n        }), but it is different from the VAPID public key you just ${\n          isGeneration ? `generated` : `uploaded`\n        }. We will replace it with the new VAPID public key.`\n      )\n    );\n  }\n  if (!appJson.expo.notification) {\n    appJson.expo.notification = {};\n  }\n  appJson.expo.notification.vapidPublicKey = results.vapidPublicKey;\n  changedProperties.push('expo.notification.vapidPublicKey');\n\n  if (changedProperties.length) {\n    log(`Writing to app.json...`);\n    await fse.writeFile(configPath, JSON.stringify(appJson, null, 2));\n    log(chalk.green(`Wrote ${changedProperties.join(', ')} to app.json.`));\n  }\n\n  log(chalk.green('All done!'));\n\n  return results;\n}\n"],"file":"push-creds.js"}